@model List<CAPS.Models.Products>

@{
	ViewData["Title"] = "Products";
}

<div class="container my-4">
	<div class="d-flex justify-content-between align-items-center mb-3">
		<h2>@ViewData["Title"]</h2>
		<a asp-action="UpSert" class="btn btn-primary">
			<i class="bi bi-plus-lg"></i> New Product
		</a>
	</div>

	@if (TempData["SuccessMessage"] != null)
	{
		<div class="alert alert-success alert-dismissible fade show" role="alert">
			@TempData["SuccessMessage"]
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>
	}

	@if (TempData["WarningMessage"] != null)
	{
		<div class="alert alert-warning alert-dismissible fade show" role="alert">
			@TempData["WarningMessage"]
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>
	}

	<div class="table-responsive">
		<table class="table table-striped table-bordered align-middle">
			<thead class="table-dark">
				<tr>
					<th>Name</th>
					<th>Description</th>
					<th>Category</th>
					<th>Stock</th>
					<th>Active</th>
					<th>Date Created</th>
					<th class="text-center">Actions</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var item in Model)
				{
					<tr>
						<td>@item.Name</td>
						<td class="text-truncate" style="max-width: 150px;">
							@(
								!string.IsNullOrEmpty(item.Description) && item.Description.Length > 50
								? item.Description.Substring(0, 50) + "…"
								: item.Description
								)
						</td>
						<td>@item.Category</td>
						<td>
							@if (item.StockQuantity > 10)
							{
								<span class="badge bg-success">@item.StockQuantity</span>
							}
							else if (item.StockQuantity > 0)
							{
								<span class="badge bg-warning">@item.StockQuantity</span>
							}
							else
							{
								<span class="badge bg-danger">@item.StockQuantity</span>
							}
						</td>


						<td>
							@if (item.IsActive)
							{
								<span class="badge bg-success">Yes</span>
							}
							else
							{
								<span class="badge bg-secondary">No</span>
							}
						</td>
						<td>@item.DateCreated.ToString("yyyy-MM-dd")</td>
						<td class="text-center">
							<a asp-action="UpSert" asp-route-id="@item.ProductId" class="btn btn-sm btn-warning" title="Edit">
								<i class="bi bi-pencil-square"></i>
							</a>
							<a asp-action="Delete" asp-route-id="@item.ProductId" class="btn btn-sm btn-danger" title="Delete">
								<i class="bi bi-trash"></i>
							</a>
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>

	@if (Model.Count == 0)
	{
		<div class="text-center my-5">
			<i class="bi bi-box h1 text-muted"></i>
			<h4 class="text-muted mt-3">No products found.</h4>
			<p class="text-muted">Start by adding your first product.</p>
			<a asp-action="UpSert" class="btn btn-primary">
				<i class="bi bi-plus-lg"></i> Add First Product
			</a>
		</div>
	}
</div>

<style>
	.table th {
		white-space: nowrap;
		vertical-align: middle;
	}
	
	.table td {
		vertical-align: middle;
	}
	
	.text-truncate {
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}
</style>
